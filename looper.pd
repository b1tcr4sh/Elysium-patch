#N canvas 0 56 1728 996 12;
#X obj 1380 -21 adc~;
#X obj 1381 24 *~;
#X obj 1266 73 env~;
#X obj 728 -20 bng 20 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 728 7 timer;
#X obj 115 262 bng 20 250 50 0 \$0-reset \$0-reset clear\ buffer 0 -10 0 12 #fcfcfc #000000 #000000;
#X text 1379 -51 rec;
#X obj 7 217 bng 20 250 50 0 \$0-loop-start \$0-loop-start set\ loop\ start 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 6 263 bng 20 250 50 0 \$0-loop-end \$0-loop-end set\ loop\ end 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 585 -93 r master-onoff;
#X obj 578 -68 sel 0;
#X text -61 609 problem: because buffer dynamic adjusts to length of current sound (which is good) \, that means it can't record sounds longer than it's current length;
#X text -56 670 solution: update length every sample by checking if current length is lesser than current recording sample. Once it is \, increase the buffer size until done recording;
#X obj 991 66 s test-array-grain-file-position-max;
#X obj 877 22 / 1000;
#X obj 1381 85 *~;
#X obj 1430 60 line~;
#X text 92 518 problem 2 (or feature \, if you prefer) \; could get clicks at beginning/end points of loop \; fix implemented to the left of this comment, f 51;
#X text 373 626 alternate solution: don't resize the buffer at all \, just set it to be large enough for anything you plan to loop \, and don't worry about the allocated memory you're not using ... dynamically allocating memory for audio in real-time can involve latency and/or processing spikes \, though I am fairly sure Miller has done all that can be done to minimize such problems, f 64;
#X obj 1459 114 r loop-rec;
#X obj 727 -92 r loop-rec;
#X obj 727 -68 route start stop;
#X obj 153 322 t b b;
#X obj 181 363 del 10;
#X obj 1431 33 r loop-lev;
#X msg 182 393 \; loop-rec stop \; first-pass-loop-rec 0;
#X obj 809 140 spigot;
#X obj 939 177 r first-pass-loop-rec;
#X obj 1448 -30 pack 0 20;
#X obj 1447 -4 line~;
#X obj 767 415 *~;
#X obj 834 364 line~;
#X obj 916 283 r \$0-loop-recirc;
#X obj 871 312 *;
#X obj 887 258 float;
#X obj 939 204 == 0;
#X obj 767 439 throw~ \$0-recirc~;
#X obj 1495 61 catch~ \$0-recirc~;
#X obj 1381 109 +~;
#X msg 1108 342 0;
#X obj 1221 250 loadbang;
#X obj 1222 301 samplerate~;
#X obj 1221 276 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X text 858 527 donecanvasdialog <xunit> <yunits> <gopmode> <xfrom> <yfrom> <xto> <yto> <width> <height> <xoffset> <yoffset> 1;
#X msg 1448 523 \; \$1-loop-buffer1 vis \$2;
#X obj 1448 419 tgl 19 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X obj 1448 443 t b f;
#X obj 1448 467 float \$0;
#X obj 1448 491 pack;
#X obj 1422 650 float \$0;
#X obj 1422 580 loadbang;
#X obj 1420 611 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 877 51 s \$0-loop-dur;
#N canvas 1278 574 450 278 (subpatch) 0;
#X array loop1 100 float 0;
#X coords 0 1 100 -1 200 140 2 0 0;
#X restore 215 21 graph;
#X msg 1250 685 \; \$1-loop-view edit 0 \; \$1-loop-view vis 0 \; \$1-loop-view bounds 0 1 100 -1;
#X msg 133 476 \; loop-lev 0 10;
#X obj 396 352 float \$0;
#X obj 809 -21 bng 20 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 777 7 timer;
#X obj 848 103 r;
#X obj 1266 100 - 100;
#X obj 1266 124 clip -100 0;
#X obj 1266 148 s \$0-rec-meter;
#X obj 1405 -115 r master-onoff;
#X obj 1405 -90 sel 1;
#X obj 114 218 tgl 19 0 \$0-loop-toggle \$0-loop-toggle loop\ playback\ on/off 0 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X obj 214 162 hsl 200 19 0 1 0 0 empty \$0-loop-pos empty -2 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X obj 311 203 nbx 15 17 -1e+37 1e+37 0 0 empty \$0-loop-dur loop\ length\ (s) 0 -10 0 12 #fcfcfc #000000 #000000 0 256;
#X obj 568 -42 s \$0-reset;
#X obj 424 167 send~ loop-out;
#X obj 729 41 s \$1-start;
#X obj 778 66 s \$1-end;
#X msg 395 379 \; \$1-reset-timer \; \$1-rec-buffer const \; \$1-view const \; first-pass-loop-rec 1;
#X obj 8 21 level-control \$1-recirc;
#X obj 612 442 loadbang;
#X obj 613 492 symbol \$1;
#X msg 614 518 \; loop-view rename \$1;
#X obj 613 467 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 101 22 level-control \$1-input;
#X obj 1448 -59 r \$1-input;
#X obj 425 21 level-control \$1-output;
#X obj 1222 374 array size \$1-buffer;
#X obj 1223 220 array define \$1-buffer;
#X obj 1434 373 s \$1-buffer-size;
#X obj 1380 167 tabwrite~ \$1-buffer;
#X obj 1024 498 tabwrite~ \$1-buffer;
#X obj 976 593 array get \$1-buffer, f 23;
#X obj 987 37 s test-array-grain-file-position-in;
#X obj 1222 325 * 1200;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 0 15 0;
#X connect 2 0 60 0;
#X connect 3 0 4 0;
#X connect 4 0 70 0;
#X connect 7 0 22 0;
#X connect 9 0 10 0;
#X connect 10 0 68 0;
#X connect 14 0 52 0;
#X connect 15 0 38 0;
#X connect 16 0 15 1;
#X connect 19 0 84 0;
#X connect 20 0 21 0;
#X connect 21 0 3 0;
#X connect 21 1 57 0;
#X connect 22 0 55 0;
#X connect 22 1 23 0;
#X connect 23 0 25 0;
#X connect 24 0 16 0;
#X connect 27 0 35 0;
#X connect 27 0 39 0;
#X connect 28 0 29 0;
#X connect 29 0 1 1;
#X connect 30 0 36 0;
#X connect 31 0 30 1;
#X connect 32 0 33 1;
#X connect 34 0 33 0;
#X connect 35 0 34 1;
#X connect 37 0 38 1;
#X connect 38 0 84 0;
#X connect 39 0 30 1;
#X connect 40 0 42 0;
#X connect 41 0 88 0;
#X connect 42 0 41 0;
#X connect 45 0 46 0;
#X connect 46 0 47 0;
#X connect 46 1 48 1;
#X connect 47 0 48 0;
#X connect 48 0 44 0;
#X connect 49 0 54 0;
#X connect 50 0 51 0;
#X connect 51 0 49 0;
#X connect 56 0 72 0;
#X connect 57 0 58 1;
#X connect 58 0 71 0;
#X connect 59 0 26 1;
#X connect 60 0 61 0;
#X connect 61 0 62 0;
#X connect 63 0 64 0;
#X connect 74 0 77 0;
#X connect 75 0 76 0;
#X connect 77 0 75 0;
#X connect 79 0 28 0;
#X connect 80 0 69 0;
#X connect 88 0 81 0;
#X connect 88 0 83 0;
#X coords 0 -1 1 1 550 300 2 0 0;
